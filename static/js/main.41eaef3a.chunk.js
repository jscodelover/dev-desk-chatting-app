(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{179:function(e,t,a){},297:function(e,t,a){e.exports=a(577)},568:function(e,t,a){},570:function(e,t,a){},572:function(e,t,a){},577:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(68),o=a.n(s),i=a(69),c=a(39),l=a(256),u=a(605),h=a(17),d={SET_USER:"SET_USER",SET_OTHER_USERS:"SET_OTHER_USERS",CLEAR_USER:"CLEAR_USER",SET_CHANNEL:"SET_CHANNEL",SET_OTHER_CHANNELS:"SET_OTHER_CHANNELS",ALL_CHANNEL_ID:"ALL_CHANNEL_ID",SET_PRIVATE_CHANNEL:"SET_PRIVATE_CHANNEL",ACTIVE_CHANNEL_ID:"ACTIVE_CHANNEL_ID",SET_USERS_IN_CHANNEL:"SET_USERS_IN_CHANNEL",SHOW_CHANNEL_INFO:"SHOW_CHANNEL_INFO",SET_NOTIFICATION:"SET_NOTIFICATION",SET_MESSAGES:"SET_MESSAGES",CLEAR_MESSAGES:"CLEAR_MESSAGES"};function m(e){return{type:d.SET_CHANNEL,payload:e}}function p(e){return{type:d.ACTIVE_CHANNEL_ID,payload:e}}function f(e){return{type:d.SET_PRIVATE_CHANNEL,payload:e}}function g(e){return{type:d.SHOW_CHANNEL_INFO,payload:e}}function v(e){return{type:d.SET_NOTIFICATION,payload:e}}function E(){return{type:d.CLEAR_MESSAGES}}var b={currentUser:{},loading:!0,otherUsers:[],isAuthenticated:!1},C={currentChannel:{},otherChannels:[],channelIDs:[],privateChannel:!1,activeChannelID:"",usersInChannel:[],showChannelInfo:!1},S={notification:[]},I={messages:[]},y=Object(i.combineReducers)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.SET_USER:return Object(h.a)({},e,{currentUser:t.payload,isAuthenticated:!0,loading:!1});case d.CLEAR_USER:return Object(h.a)({},e,{currentUser:{},isAuthenticated:!1,loading:!1});case d.SET_OTHER_USERS:return Object(h.a)({},e,{otherUsers:t.payload});default:return e}},channel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.SET_CHANNEL:return Object(h.a)({},e,{currentChannel:t.payload});case d.CLEAR_CHANNEL:return Object(h.a)({},e,{currentChannel:{}});case d.ACTIVE_CHANNEL_ID:return Object(h.a)({},e,{activeChannelID:t.payload});case d.ALL_CHANNEL_ID:return Object(h.a)({},e,{channelIDs:e.channelIDs.concat(t.payload)});case d.SET_PRIVATE_CHANNEL:return Object(h.a)({},e,{privateChannel:t.payload});case d.SET_OTHER_CHANNELS:return Object(h.a)({},e,{otherChannels:t.payload});case d.SET_USERS_IN_CHANNEL:return Object(h.a)({},e,{usersInChannel:t.payload});case d.SHOW_CHANNEL_INFO:return Object(h.a)({},e,{showChannelInfo:t.payload});default:return e}},notification:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.SET_NOTIFICATION:return Object(h.a)({},e,{notification:t.payload});default:return e}},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.SET_MESSAGES:return Object(h.a)({},e,{messages:t.payload});case d.CLEAR_MESSAGES:return Object(h.a)({},e,{messages:[]});default:return e}}}),D=a(18),O=a(19),k=a(21),N=a(20),w=a(22),j=a(286),T=a(592),A=a(604),M=a(609),_=a(610),R=a(46),U=a.n(R),x=a(47),L=a(588),H=a(601),P=a(602),F=a(253),W=a(593),B=a(606),Y=a(599),V=a(598);a(179),a(318),a(319),a(320);U.a.initializeApp({apiKey:"AIzaSyAJR_w_2imHciuDh66hEOE7UzpQtLEWYZQ",authDomain:"react-slack-for-dev.firebaseapp.com",databaseURL:"https://react-slack-for-dev.firebaseio.com",projectId:"react-slack-for-dev",storageBucket:"react-slack-for-dev.appspot.com",messagingSenderId:"879689864897"});var z=U.a,G=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).handleChange=function(e){a.setState(Object(x.a)({},e.target.name,e.target.value))},a.displayError=function(e){return e.map(function(e,t){return r.a.createElement("p",{key:t},e)})},a.errorHighlighter=function(e,t){return e.some(function(e){return e.toLowerCase().includes(t)})},a.handleSubmit=function(e){e.preventDefault(),a.isFormValid(a.state)&&(a.setState({loading:!0,error:[]}),z.auth().signInWithEmailAndPassword(a.state.email,a.state.password).then(function(e){a.setState({loading:!1}),a.props.history.push("/")}).catch(function(e){console.log(e),a.setState({error:[e.message],loading:!1})}))},a.isFormValid=function(e){var t=e.email,n=e.password,r=[];return t.length&&n.length?!(n.length<6)||(a.setState({error:r.concat("Password Should be more than 6 digits")}),!1):(a.setState({error:r.concat("Form is not fill")}),!1)},a.state={email:"",password:"",loading:!1,error:[]},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.state,t=e.email,a=e.password,n=e.loading,s=e.error;return r.a.createElement(H.a,{verticalAlign:"middle",textAlign:"center",className:"heading"},r.a.createElement(H.a.Column,{className:"auth-box"},r.a.createElement(P.a,{as:"h1",icon:!0,color:"teal",textAlign:"center"},r.a.createElement(F.a,{name:"code"}),"Login for DevDesk",r.a.createElement(P.a.Subheader,null,"Platform which user can use to chat and store notes.")),r.a.createElement(W.a,{size:"large",onSubmit:this.handleSubmit},r.a.createElement(B.a,{stacked:!0},r.a.createElement(W.a.Input,{name:"email",type:"email",icon:"mail",iconPosition:"left",placeholder:"Email",onChange:this.handleChange,value:t,className:this.errorHighlighter(s,"email")?"error":""}),r.a.createElement(W.a.Input,{name:"password",type:"password",icon:"lock",iconPosition:"left",placeholder:"Password (with min 6 digit)",onChange:this.handleChange,value:a,className:this.errorHighlighter(s,"password")?"error":""}),r.a.createElement(Y.a,{fluid:!0,type:"submit",color:"teal",disabled:n,className:n?"loading":""},"Submit")),s.length>0&&r.a.createElement(V.a,{negative:!0},r.a.createElement(V.a.Header,null,"Error"),this.displayError(s))),r.a.createElement(V.a,null,"Not a user ? ",r.a.createElement(L.a,{to:"/register"},"Resgister"))))}}]),t}(n.Component),q=a(268),K=a.n(q),$=[{colors:{sidebar:"rgba(76,60,76,1)",btn1:"rgba(242, 113, 28, 1)",btn2:"rgba(69, 182, 174, 1)"}},{colors:{sidebar:"rgba(30, 34, 58, 1)",btn1:"rgba(171, 129, 9, 1)",btn2:"rgba(219, 40, 40, 1)"}},{colors:{sidebar:"rgba(30, 74, 109,1)",btn1:"rgba(181, 102, 46,1)",btn2:"rgba(84, 24, 24,1)"}},{colors:{sidebar:"rgba(68, 34, 41,1)",btn1:"rgba(158, 125, 124,1)",btn2:"rgba(86, 57, 63,1)"}},{colors:{sidebar:"rgba(56, 67, 58,1)",btn1:"rgba(197, 149, 78,1)",btn2:"rgba(218, 110, 80,1)"}}],J=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).handleChange=function(e){a.setState(Object(x.a)({},e.target.name,e.target.value))},a.displayError=function(e){return e.map(function(e,t){return r.a.createElement("p",{key:t},e)})},a.errorHighlighter=function(e,t){return e.some(function(e){return e.toLowerCase().includes(t)})},a.handleSubmit=function(e){e.preventDefault(),a.isFormValid(a.state)&&(a.setState({loading:!0,error:[]}),z.auth().createUserWithEmailAndPassword(a.state.email,a.state.password).then(function(e){e.user.updateProfile({displayName:a.state.username,photoURL:"https://www.gravatar.com/avatar/".concat(K()(a.state.email),"?d=identicon")}).then(function(){a.saveUser(e)})}).catch(function(e){console.log(e),a.setState({error:[e.message],loading:!1})}))},a.saveUser=function(e){a.state.user.child(e.user.uid).set({userID:e.user.uid,username:e.user.displayName,picture:e.user.photoURL,createdOn:e.user.metadata.creationTime,color:[$[0].colors.sidebar,$[0].colors.btn1,$[0].colors.btn2]})},a.isFormValid=function(e){var t=e.username,n=e.email,r=e.password,s=e.passwordConfirmation,o=(e.error,[]);return t.length&&n.length&&r.length&&s.length?r.length<6||s.length<6?(a.setState({error:o.concat("Password Should be more than 6 digits")}),!1):r===s||(a.setState({error:o.concat("Password does not match")}),!1):(a.setState({error:o.concat("Form is not fill")}),!1)},a.state={username:"",email:"",password:"",passwordConfirmation:"",loading:!1,error:[],user:z.database().ref("users")},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.state,t=e.username,a=e.email,n=e.password,s=e.passwordConfirmation,o=e.loading,i=e.error;return r.a.createElement(H.a,{verticalAlign:"middle",textAlign:"center",className:"heading"},r.a.createElement(H.a.Column,{className:"auth-box"},r.a.createElement(P.a,{as:"h1",icon:!0,color:"teal",textAlign:"center"},r.a.createElement(F.a,{name:"code"}),"Register for DevDesk",r.a.createElement(P.a.Subheader,null,"Platform which user can use to chat and store notes.")),r.a.createElement(W.a,{size:"large",onSubmit:this.handleSubmit},r.a.createElement(B.a,{stacked:!0},r.a.createElement(W.a.Input,{name:"username",type:"text",icon:"user",iconPosition:"left",placeholder:"UserName",onChange:this.handleChange,value:t}),r.a.createElement(W.a.Input,{name:"email",type:"email",icon:"mail",iconPosition:"left",placeholder:"Email",onChange:this.handleChange,value:a,className:this.errorHighlighter(i,"email")?"error":""}),r.a.createElement(W.a.Input,{name:"password",type:"password",icon:"lock",iconPosition:"left",placeholder:"Password (with min 6 digit)",onChange:this.handleChange,value:n,className:this.errorHighlighter(i,"password")?"error":""}),r.a.createElement(W.a.Input,{name:"passwordConfirmation",type:"password",icon:"repeat",iconPosition:"left",placeholder:"Confirm Password",onChange:this.handleChange,value:s,className:this.errorHighlighter(i,"password")?"error":""}),r.a.createElement(Y.a,{fluid:!0,type:"submit",color:"teal",disabled:o,className:o?"loading":""},"Submit")),i.length>0&&r.a.createElement(V.a,{negative:!0},r.a.createElement(V.a.Header,null,"Error"),this.displayError(i))),r.a.createElement(V.a,null,"Already a user ? ",r.a.createElement(L.a,{to:"/login"},"Login"))))}}]),t}(n.Component),Q=a(589),Z=a(603),X=a(600),ee=a(594),te=a(166),ae=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).openModal=function(){a.setState({modal:!0})},a.closeModal=function(){a.setState({modal:!1})},a.sidebarColorHandler=function(e){var t=e.r,n=e.g,r=e.b,s=e.a;a.setState({sidebar:"rgba(".concat(t,",").concat(n,",").concat(r,",").concat(s,")"),btn1:"rgba(".concat(t-11,",").concat(n-6,",").concat(r-5,",",.8,")"),btn2:"rgba(".concat(t-11,",").concat(n-6,",").concat(r-5,",",.9,")")})},a.textColorHandler=function(e){var t=e.r,n=e.g,r=e.b,s=e.a;a.setState({text:"rgba(".concat(t,",").concat(n,",").concat(r,",").concat(s,")")})},a.saveColor=function(){var e=a.state,t=e.userRef,n=e.sidebar,r=e.btn1,s=e.btn2,o=e.text,i=a.props.user;t.child("".concat(i.userID,"/color")).update({theme:[n,r,s],text:o}).then(function(){a.setState({modal:!1})})},a.saveTheme=function(e,t,n){var r=a.state.userRef,s=a.props.user;r.child("".concat(s.userID,"/color")).update({theme:[e,t,n],text:"rgba(255,255,255,0.5)"})},a.defaultTheme=function(e,t,n){return r.a.createElement(r.a.Fragment,{key:e},r.a.createElement(Q.a,{style:{border:"none"}}),r.a.createElement("div",{className:"color-box",onClick:function(){return a.saveTheme(e,t,n)}},r.a.createElement("div",{className:"color-sidebar",style:{backgroundColor:e}},r.a.createElement("div",{className:"color-replyBtn",style:{backgroundColor:t}}),r.a.createElement("div",{className:"color-fileBtn",style:{backgroundColor:n}}))))},a.state={userRef:z.database().ref("users"),modal:!1,sidebar:"rgba(0, 0, 0, 1)",btn1:"",btn2:"",text:"rgba(255,255,255,0.9)",screenWidth:window.innerWidth},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){e.setState({screenWidth:window.innerWidth})})}},{key:"render",value:function(){var e=this,t=this.state,a=t.modal,n=t.sidebar,s=t.text;return r.a.createElement(Z.a,{as:X.a,width:"very thin",inverted:!0,vertical:!0,visible:!0,icon:"labeled",style:{position:"fixed",right:0}},this.state.screenWidth<=678?r.a.createElement(Y.a,{icon:"align justify",size:"small",onClick:this.props.showSidebar,style:{marginTop:"5px"}}):null,r.a.createElement(Q.a,{style:{border:"none"}}),r.a.createElement(Y.a,{icon:"add",size:"small",color:"blue",onClick:this.openModal}),$.map(function(t){var a=t.colors,n=a.sidebar,r=a.btn1,s=a.btn2;return e.defaultTheme(n,r,s)}),r.a.createElement(ee.a,{open:a,basic:!0,size:"small"},r.a.createElement(P.a,{as:"h2",content:"Pick your theme"}),r.a.createElement(ee.a.Content,null,r.a.createElement(P.a,{as:"h4",content:"Your Theme",style:{color:"white"}}),r.a.createElement(B.a,{inverted:!0,style:{background:n}},r.a.createElement(te.ChromePicker,{color:n,onChange:function(t){var a=t.rgb;e.sidebarColorHandler(a)}})),r.a.createElement(P.a,{as:"h4",content:"Text Color",style:{color:"white"}}),r.a.createElement(B.a,{inverted:!0,style:{background:s}},r.a.createElement(te.ChromePicker,{color:s,onChange:function(t){var a=t.rgb;e.textColorHandler(a)}}))),r.a.createElement(ee.a.Actions,null,r.a.createElement(Y.a,{color:"red",inverted:!0,onClick:this.closeModal},r.a.createElement(F.a,{name:"remove"})," Cancel"),r.a.createElement(Y.a,{color:"green",inverted:!0,onClick:this.saveColor},r.a.createElement(F.a,{name:"checkmark"})," Save"))))}}]),t}(r.a.Component),ne=a(278),re=a.n(ne),se=a(596),oe=a(578),ie=a(587),ce=a(607),le=a(590);function ue(){return r.a.createElement(ce.a,{active:!0},r.a.createElement(le.a,{size:"huge"},"Preparing Chat...."))}var he=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).dropdownOptions=function(){return[{key:"avatar",text:r.a.createElement("span",{onClick:a.modal},"Change Avatar")},{key:"signout",text:r.a.createElement("span",{onClick:a.handleSignout},"Sign Out")}]},a.modal=function(){a.setState(function(e){return{modal:!e.modal}})},a.handleSignout=function(){z.auth().signOut().then(function(){z.database().ref("users/".concat(a.props.user.userID)).set(Object(h.a)({},a.props.user,{lastSeen:z.database.ServerValue.TIMESTAMP,status:"offline"})),r.a.createElement(A.a,{to:"/login"})}).catch(function(e){console.log("Can't LogOut. Try Again!!")})},a.selectedImage=function(e){var t=e.target.files[0];a.setState({image:t})},a.preview=function(){a.avatar&&a.avatar.getImageScaledToCanvas().toBlob(function(e){var t=URL.createObjectURL(e);a.setState({croppedImage:t,blob:e})})},a.save=function(){var e=a.state,t=e.storageRef,n=e.userRef,r=e.blob,s=a.props.user;t.child("".concat(s.userID,"/images-").concat(s.userID,".jpg")).put(r,{contentType:"image/jpeg"}).then(function(e){a.setState({loading:!0}),a.modal(),e.ref.getDownloadURL().then(function(e){n.child(s.userID).update(Object(h.a)({},s,{picture:e})),a.setState({croppedImage:"",blob:"",image:"",loading:!1})}).catch(function(e){a.setState({croppedImage:"",blob:"",image:"",loading:!1})})})},a.state={modal:!1,image:"",croppedImage:"",userRef:z.database().ref("users"),storageRef:z.storage().ref(),blob:"",loading:!1},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.modal,n=t.image,s=t.croppedImage,o=t.loading,i=this.props.user.color;return r.a.createElement(r.a.Fragment,null,o?r.a.createElement(ue,null):r.a.createElement(H.a,null,r.a.createElement(H.a.Column,null,r.a.createElement(H.a.Row,{style:{padding:"1.2em"}},r.a.createElement(P.a,{inverted:!0,as:"h2",style:{color:"".concat(i.text)}},r.a.createElement(F.a,{name:"code"}),r.a.createElement(P.a.Content,null,"DevDesk")),r.a.createElement(P.a,{style:{padding:"0.25em",color:"".concat(i.text)},as:"h3",inverted:!0,textAlign:"center"},r.a.createElement(se.a,{className:"profile-dropdown-box",trigger:r.a.createElement("div",{className:"dropdown-name"},r.a.createElement(oe.a,{src:this.props.user.picture,spaced:"right",avatar:!0}),r.a.createElement("span",null,this.props.user.username)),options:this.dropdownOptions()}))))),r.a.createElement(ee.a,{open:a,basic:!0},r.a.createElement(P.a,{content:"Change Avatar"}),r.a.createElement(ee.a.Content,null,r.a.createElement(ie.a,{fluid:!0,label:"choose a image",accept:"image/*",type:"file",onChange:this.selectedImage}),n&&r.a.createElement(H.a,null,r.a.createElement(H.a.Row,null,r.a.createElement(H.a.Column,{width:8},r.a.createElement(re.a,{ref:function(t){return e.avatar=t},image:n,width:300,height:300,scale:1.2})),r.a.createElement(H.a.Column,{width:8},r.a.createElement(oe.a,{src:s,size:"small",style:{marginTop:"27%",marginLeft:"27%"}}))))),r.a.createElement(ee.a.Actions,null,r.a.createElement(Y.a,{color:"red",inverted:!0,onClick:this.modal},r.a.createElement(F.a,{name:"remove"})," Cancel"),r.a.createElement(Y.a,{color:"green",inverted:!0,onClick:this.preview},r.a.createElement(F.a,{name:"image"})," Preview"),s&&r.a.createElement(Y.a,{color:"green",inverted:!0,onClick:this.save},r.a.createElement(F.a,{name:"image"})," Save"))))}}]),t}(n.Component),de=a(252);function me(e,t){return e.userID>t?"".concat(e.userID).concat(t):"".concat(t).concat(e.userID)}var pe=function(e){function t(e,t){if(t.length){var a=t.findIndex(function(t){return e===t.id});if(a>-1)return t[a].count}}var a=e.channels,n=e.activeChannelID,s=e.notification,o=e.changeChannel,i=e.users,c=e.userID,l=e.hideStarredID,u=e.textColor,h=e.closedSidebar;return r.a.createElement(r.a.Fragment,null,a?r.a.createElement(r.a.Fragment,null,a.length>0&&a.map(function(e){return!l.includes(e.id)&&r.a.createElement(X.a.Item,{className:"sidebar-heading",key:e.id,name:e.channelName,onClick:function(){o(e),h()},active:e.id===n},r.a.createElement("span",{style:{color:u}},"# ",e.channelName),t(e.id,s)?r.a.createElement(de.a,{color:"red"},t(e.id,s)):"")})):r.a.createElement(r.a.Fragment,null,i.length&&i.map(function(e){return!l.includes(e.userID)&&r.a.createElement(X.a.Item,{className:"sidebar-heading",key:e.userID,active:e.userID===n,onClick:function(){o(e),h()}},r.a.createElement("span",{style:{color:u}},r.a.createElement(F.a,{name:"circle",color:"online"===e.status?"green":"red"}),e.username),t(me(e,c),s)?r.a.createElement(de.a,{color:"red"},t(me(e,c),s)):"")})))};function fe(e,t,a,n){var r=z.database().ref("notification");r.child(a).once("value",function(s){if(s.hasChild(t)){var o=s.val()[t],i={id:t,total:e};o.id===n||o.id.includes(n)?(i.count=0,i.lastTotal=e,r.child(a).child(t).set(Object(h.a)({},i))):(i.count=e-o.lastTotal,i.lastTotal=o.lastTotal,r.child(a).child(t).set(Object(h.a)({},i)))}else r.child(a).child(t).update({id:t,lastTotal:e,count:0,total:e})})}function ge(e,t){var a=z.database().ref("notification");a.child(t).child(e).once("value",function(n){var r=n.val();a.child(t).child(e).set({id:e,lastTotal:r.total,count:0,total:r.total})})}function ve(e,t){z.database().ref("typing").child(e.id).child(t.userID).remove()}function Ee(e,t){sessionStorage.setItem(e,t)}function be(e){sessionStorage.removeItem(e)}function Ce(e){return sessionStorage.getItem(e)}var Se=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).addListener=function(){var e=[];a.displayNotification(),a.state.channelRef.on("child_added",function(t){a.setState({loading:!0}),a.props.channelID(t.val().id),e.push(t.val()),a.props.setOtherChannels(e),a.setFirstChannel(),a.checkNotification(t.val().id),a.setState({loading:!1})})},a.removeListener=function(){a.state.channelRef.off()},a.setFirstChannel=function(){var e=a.state.firstChannelActivated,t=a.props.channels;e||(a.setState({firstChannelActivated:!0}),a.changeChannel(t[0]))},a.handleOpenModal=function(){a.setState({modal:!0})},a.handleCloseModal=function(){a.setState({modal:!1})},a.handleChange=function(e){a.setState(Object(x.a)({},e.target.name,e.target.value))},a.handleSubmit=function(){var e=a.state,t=e.channelName,n=e.channelDetail,r=e.channelRef,s=e.userID;if(a.isFormValid(t,n)){var o=r.push().key;a.props.channelID(o),r.child(o).update({id:o,channelName:t,channelDetail:n,createdBy:s,createdOn:z.database.ServerValue.TIMESTAMP}).then(function(){a.setState({channelName:"",channelDetail:""}),a.props.setActiveChannelID(o),a.handleCloseModal()})}},a.isFormValid=function(e,t){return e.length&&t.length},a.changeChannel=function(e){e.id!==a.props.channel.id&&(be("time"),a.props.setActiveChannelID(e.id),a.props.channelInStore(Object(h.a)({},e)),a.props.setPrivateChannel(!1),ge(e.id,a.state.userID),a.props.clearMessages())},a.checkNotification=function(e){a.state.messageRef.child(e).on("value",function(t){fe(t.numChildren(),e,a.state.userID,a.props.activeChannelID)})},a.displayNotification=function(){var e=a.state,t=e.notificationRef,n=e.userID;t.child(n).on("value",function(e){var t=[];for(var n in e.val())t.push(e.val()[n]);a.props.setNotification(t)})},a.state={userID:a.props.user.userID,modal:!1,channelName:"",channelDetail:"",channelRef:z.database().ref("channels"),messageRef:z.database().ref("messages"),notificationRef:z.database().ref("notification"),activeChannelID:"",firstChannelActivated:!1,loading:!1},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){this.addListener()}},{key:"componentWillUnmount",value:function(){this.removeListener()}},{key:"render",value:function(){var e=this,t=this.state,a=t.modal,r=t.channelName,s=t.channelDetail,o=t.loading,i=this.props,c=i.channels,l=i.activeChannelID,u=i.user,h=i.notification,d=i.closedSidebar;return n.createElement(n.Fragment,null,o?n.createElement(ue,null):n.createElement(n.Fragment,null,n.createElement(X.a.Menu,null,n.createElement(X.a.Item,{className:"sidebar-heading"},n.createElement("span",{style:{fontWeight:"bold",color:u.color.text}},n.createElement(F.a,{name:"discussions"})," Channel (",c.length,")",n.createElement(F.a,{style:{float:"right",cursor:"pointer"},name:"add",onClick:this.handleOpenModal}))),n.createElement(pe,{hideStarredID:u.starred?u.starred:[],channels:c,textColor:u.color.text,activeChannelID:l,notification:h,changeChannel:function(t){ve(e.props.channel,u),e.changeChannel(t)},closedSidebar:d})),n.createElement(ee.a,{open:a,basic:!0,onClose:this.handleCloseModal},n.createElement(ee.a.Header,null,"Add a Channel"),n.createElement(ee.a.Content,null,n.createElement(W.a,{onSubmit:this.handleSubmit},n.createElement(W.a.Field,null,n.createElement(ie.a,{fluid:!0,label:"Name of Channel",name:"channelName",onChange:this.handleChange,value:r})),n.createElement(W.a.Field,null,n.createElement(ie.a,{fluid:!0,label:"About the Channel",name:"channelDetail",onChange:this.handleChange,value:s})))),n.createElement(ee.a.Actions,null,n.createElement(Y.a,{color:"red",inverted:!0,onClick:this.handleCloseModal},n.createElement(F.a,{name:"remove"})," No"),n.createElement(Y.a,{color:"green",inverted:!0,onClick:this.handleSubmit},n.createElement(F.a,{name:"checkmark"})," Yes")))))}}]),t}(n.Component),Ie=Object(c.b)(function(e){var t=e.channel,a=e.notification;return{activeChannelID:t.activeChannelID,channels:t.otherChannels,notification:a.notification,channel:t.currentChannel}},function(e){return{channelInStore:function(t){return e(m(t))},channelID:function(t){return e((a=t,{type:d.ALL_CHANNEL_ID,payload:a}));var a},setPrivateChannel:function(t){return e(f(t))},setActiveChannelID:function(t){return e(p(t))},setOtherChannels:function(t){return e((a=t,{type:d.SET_OTHER_CHANNELS,payload:a}));var a},setNotification:function(t){return e(v(t))},clearMessages:function(){return e(E())}}})(Se),ye=a(80),De=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).changeChannel=function(e){me(e,a.props.user.userID)!==a.props.channel.id&&(be("time"),a.props.setActiveChannelID(e.userID),a.props.setChannel({channelName:e.username,id:me(e,a.props.user.userID)}),a.props.setPrivateChannel(!0),ge(me(e,a.props.user.userID),a.props.user.userID),a.props.clearMessages())},a.checkNotification=function(e){a.state.messageRef.child(e).on("value",function(t){fe(t.numChildren(),e,a.props.user.userID,a.props.activeChannelID)})},a.displayNotification=function(){var e=a.state.notificationRef,t=a.props.user.userID;e.child(t).on("value",function(e){var t=[];for(var n in e.val())t.push(e.val()[n]);a.props.setNotification(t)})},a.state={userRef:z.database().ref("users"),messageRef:z.database().ref("messages"),notificationRef:z.database().ref("notification"),activeChannel:"",loading:!1},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state.userRef,a=this.props.user,n=[];this.displayNotification(),t.on("child_added",function(t){e.setState({loading:!0}),a.userID!==t.val().userID&&(n.push(t.val()),e.props.setOtherUsers(n),e.checkNotification(me(t.val(),e.props.user.userID)),e.setState({loading:!1}))}),t.on("child_changed",function(t){if(a.userID!==t.val().userID){var n=t.val().userID,r=e.props.totalUsers.findIndex(function(e){return e.userID===n}),s=Object(ye.a)(e.props.totalUsers);s[r]=t.val(),e.props.setOtherUsers(s)}})}},{key:"componentWillUnmount",value:function(){this.state.userRef.off()}},{key:"render",value:function(){var e=this,t=this.state.loading,a=this.props,n=a.activeChannelID,s=a.user,o=a.totalUsers,i=a.notification,c=a.channel,l=a.closedSidebar;return r.a.createElement(r.a.Fragment,null,t?r.a.createElement(ue,null):r.a.createElement(X.a.Menu,{style:{marginTop:"2rem"}},r.a.createElement(X.a.Item,{className:"sidebar-heading"},r.a.createElement("span",{style:{fontWeight:"bold",color:s.color.text}},r.a.createElement(F.a,{name:"envelope"})," Direct Messages "," "," (",o.length,")")),o.length?r.a.createElement(pe,{hideStarredID:s.starred?s.starred:[],users:o,activeChannelID:n,notification:i,userID:s.userID,textColor:s.color.text,changeChannel:function(t){ve(c,e.props.user),e.changeChannel(t)},closedSidebar:l}):""))}}]),t}(r.a.Component),Oe=Object(c.b)(function(e){var t=e.channel,a=e.user,n=e.notification;return{activeChannelID:t.activeChannelID,totalUsers:a.otherUsers,notification:n.notification,channel:t.currentChannel}},function(e){return{setActiveChannelID:function(t){return e(p(t))},setPrivateChannel:function(t){return e(f(t))},setChannel:function(t){return e(m(t))},setOtherUsers:function(t){return e((a=t,{type:d.SET_OTHER_USERS,payload:a}));var a},setNotification:function(t){return e(v(t))},clearMessages:function(){return e(E())}}})(De),ke=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).findHiddenStarredID=function(){var e=a.props,t=e.otherUsers,n=e.channelIDs,r=e.starred,s=n.reduce(function(e,t){var n=r.includes(t);return n||0!==e.length&&e.includes(n)?e:(a.checkNotificationChannel(t),e.concat(t))},[]);a.setState({hideStarredID_ForChannel:s});var o=t.reduce(function(e,t){var n=r.includes(t.userID);return n||0!==e.length&&e.includes(n)?e:(a.checkNotificationUser(me(t,a.props.user.userID)),e.concat(t.userID))},[]);a.setState({hideStarredID_ForUser:o})},a.changeChannel=function(e){e.id!==a.props.channel.id&&(be("time"),a.props.setActiveChannelID(e.id),a.props.setChannel(Object(h.a)({},e)),a.props.setPrivateChannel(!1),ge(e.id,a.props.user.userID),a.props.clearMessages())},a.changeUser=function(e){me(e,a.props.user.userID)!==a.props.channel.id&&(be("time"),a.props.setActiveChannelID(e.userID),a.props.setChannel({channelName:e.username,id:me(e,a.props.user.userID)}),a.props.setPrivateChannel(!0),ge(me(e,a.props.user.userID),a.props.user.userID),a.props.clearMessages())},a.checkNotificationChannel=function(e){a.state.messageRef.child(e).on("value",function(t){fe(t.numChildren(),e,a.props.user.userID,a.props.activeChannelID)})},a.checkNotificationUser=function(e){a.state.messageRef.child(e).on("value",function(t){fe(t.numChildren(),e,a.props.user.userID,a.props.activeChannelID)})},a.displayNotification=function(){var e=a.state.notificationRef,t=a.props.user.userID;e.child(t).on("value",function(e){var t=[];for(var n in e.val())t.push(e.val()[n]);a.props.setNotification(t)})},a.state={hideStarredID_ForChannel:[],hideStarredID_ForUser:[],messageRef:z.database().ref("messages"),notificationRef:z.database().ref("notification")},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){this.displayNotification(),this.findHiddenStarredID()}},{key:"componentDidUpdate",value:function(e){e.starred!==this.props.starred&&this.findHiddenStarredID()}},{key:"render",value:function(){var e=this,t=this.state,a=t.hideStarredID_ForChannel,n=t.hideStarredID_ForUser,s=this.props,o=s.otherChannels,i=s.otherUsers,c=s.activeChannelID,l=s.user,u=s.notification,h=s.closedSidebar;return r.a.createElement(X.a.Menu,{style:{marginBottom:"2rem"}},r.a.createElement(X.a.Item,{className:"sidebar-heading"},r.a.createElement("span",{style:{fontWeight:"bold",color:l.color.text}},r.a.createElement(F.a,{name:"star"})," Starred")),r.a.createElement(pe,{hideStarredID:a,textColor:l.color.text,channels:o,activeChannelID:c,notification:u,changeChannel:function(t){e.changeChannel(t)},closedSidebar:h}),r.a.createElement(pe,{hideStarredID:n,textColor:l.color.text,users:i,activeChannelID:c,notification:u,userID:l.userID,changeChannel:function(t){e.changeUser(t)},closedSidebar:h}))}}]),t}(r.a.Component),Ne=Object(c.b)(function(e){var t=e.user,a=e.channel,n=e.notification;return{otherUsers:t.otherUsers,otherChannels:a.otherChannels,channelIDs:a.channelIDs,activeChannelID:a.activeChannelID,starred:t.currentUser.starred.split(","),user:t.currentUser,channel:a.currentChannel,notification:n.notification}},function(e){return{setActiveChannelID:function(t){return e(p(t))},setPrivateChannel:function(t){return e(f(t))},setChannel:function(t){return e(m(t))},setNotification:function(t){return e(v(t))},clearMessages:function(){return e(E())}}})(ke),we=function(e){var t=e.user,a=e.visibleSideBar,n=e.showSidebar,s={background:t.color.theme[0],width:"17rem",fontSize:"1.3rem",zIndex:500};return r.a.createElement(Z.a,{as:X.a,direction:"right",animation:"overlay",icon:"labeled",inverted:!0,vertical:!0,visible:a,style:Object(h.a)({},s)},r.a.createElement(he,{user:t}),t.starred?r.a.createElement(Ne,{closedSidebar:n}):null,r.a.createElement(Ie,{user:t,closedSidebar:n}),r.a.createElement(Oe,{user:t,closedSidebar:n}))},je=a(595),Te=a(42),Ae=a.n(Te),Me=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).starredChannel=function(){var e=a.props,t=e.activeChannelID,n=e.user,r=a.state.userRef,s=n.starred?n.starred.split(","):[],o=s.findIndex(function(e){return e===t});o>-1?s.splice(o,1):s.push(t),r.child(n.userID).set(Object(h.a)({},n,{starred:s.join(",")}))},a.handleChange=function(e){a.props.searchMessage(e.target.value)},a.handleOpenModal=function(){a.setState({modal:!0})},a.handleCloseModal=function(){a.setState({modal:!1})},a.state={userRef:z.database().ref("users"),screenWidth:window.innerWidth,modal:!1},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){e.setState({screenWidth:window.innerWidth})})}},{key:"render",value:function(){var e=this.props,t=e.channelName,a=e.metaData,n=e.searchLoading,s=e.privateChannel,o=e.activeChannelID,i=e.user,c=e.showChannelInfo,l=e.hasSearchData,u=e.clearSearchData,h=this.state,d=h.screenWidth,m=h.modal;return r.a.createElement(B.a,{clearing:!0,className:"messageHeader"},r.a.createElement(P.a,{as:"h2",floated:"left",fluid:"true",style:{marginBottom:0}},r.a.createElement("span",null,t,r.a.createElement(F.a,{style:{cursor:"pointer"},name:i.starred&&i.starred.includes(o)?"star":"star outline",color:i.starred&&i.starred.includes(o)?"yellow":"black",onClick:this.starredChannel})),r.a.createElement(P.a.Subheader,null,s?"offline"===a.status?Ae()(a.lastSeen).format(" Do-MM-YY, ddd, h:mm a"):r.a.createElement("span",null," ",r.a.createElement(F.a,{name:"circle",color:"green"})," Online"):a.length>1?"".concat(a.length," users"):"".concat(a.length," user"))),r.a.createElement(P.a,{floated:"right"},d>678?r.a.createElement(ie.a,{size:"mini",icon:"search",name:"searchTerm",onChange:this.handleChange,loading:n,placeholder:"Search..."}):l?r.a.createElement(de.a,{color:"red",style:{cursor:"pointer",position:"absolute",right:"52px",top:"21px"},onClick:u},r.a.createElement(F.a,{name:"search"})," Clear"):r.a.createElement(F.a,{name:"search",color:"grey",style:{cursor:"pointer"},onClick:this.handleOpenModal}),!s&&r.a.createElement(F.a,{name:"info",color:"grey",style:{cursor:"pointer"},onClick:c})),r.a.createElement(ee.a,{open:m,basic:!0,onClose:this.handleCloseModal},r.a.createElement(ee.a.Content,null,r.a.createElement(W.a,{onSubmit:this.handleSubmit},r.a.createElement(W.a.Field,null,r.a.createElement(ie.a,{fluid:!0,name:"searchItem",onChange:this.handleChange,placeholder:"Search..."})))),r.a.createElement(ee.a.Actions,null,r.a.createElement(Y.a,{color:"green",inverted:!0,onClick:this.handleCloseModal},r.a.createElement(F.a,{name:"checkmark"})," Done"))))}}]),t}(r.a.Component),_e=a(279),Re=a.n(_e),Ue=a(285),xe=a(591),Le=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).addFile=function(e){a.setState({file:e.target.files[0]})},a.sendFile=function(){var e=a.state.file;e&&(a.props.uploadFile(e),a.props.closeModal(),a.setState({file:null}))},a.state={file:null},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.props,t=e.modal,a=e.closeModal;return r.a.createElement(ee.a,{basic:!0,open:t},r.a.createElement(P.a,null,"Select a Image File"),r.a.createElement(ee.a.Content,null,r.a.createElement(ie.a,{fluid:!0,label:"File type: jpg/png",type:"file",accept:"image/png, image/jpeg",onChange:this.addFile})),r.a.createElement(ee.a.Actions,null,r.a.createElement(Y.a,{color:"red",inverted:!0,onClick:a},r.a.createElement(F.a,{name:"remove"}),"Cancel"),r.a.createElement(Y.a,{color:"green",inverted:!0,onClick:this.sendFile},r.a.createElement(F.a,{name:"checkmark"}),"Send")))}}]),t}(r.a.Component),He=function(e){var t=e.typingUsers;return r.a.createElement("div",{className:"typing"},t.map(function(e,a){return a!==t.length-1?r.a.createElement("span",{key:a},e,", "):r.a.createElement("span",{key:a},e," ")}),r.a.createElement("span",null,"is typing..."))},Pe=a(284),Fe=(a(565),function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).addEmoji=function(e){var t="";if(e.unified.length<=5)t=String.fromCodePoint("0x".concat(e.unified));else{var n=e.unified.split("-"),r=[];n.forEach(function(e){return r.push("0x"+e)}),t=String.fromCodePoint.apply(String,r)}a.props.onSelect&&a.props.onSelect(t)},a.openEmojiPicker=function(){a.setState(function(e){return{openPicker:!e.openPicker}})},a.state={openPicker:!1},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.state.openPicker;return r.a.createElement("div",{onClick:this.openEmojiPicker,style:{padding:"0px 3px 0px 5px",border:"1px solid #e2b605",display:"flex",marginRight:"1px",alignItems:"center",borderRadius:"4px",cursor:"pointer"}},r.a.createElement(F.a,{name:"smile outline",style:{fontSize:"20px",color:"#e2b605"}}),e&&r.a.createElement(Pe.a,{set:"google",onSelect:this.addEmoji,title:"Pick your emoji...",style:{width:"293px",position:"absolute",left:"0px",bottom:"38px"},showPreview:!1}))}}]),t}(r.a.Component)),We=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).getMessage=function(e){a.setState(Object(x.a)({},e.target.name,e.target.value)),function(e,t,a){var n=z.database().ref("typing");e?n.child(t.id).child(a.userID).set(a.username):ve(t,a)}(e.target.value,a.props.channel,a.props.user),e.target.value?Ee(a.props.channel.id,e.target.value):be(a.props.channel.id),a.setState({cursorPos:e.target.selectionStart})},a.formatting=function(e,t,a,n){if(a){var r=!0,s=!1,o=void 0;try{for(var i,c=a[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var l=i.value,u="blockquote"===t?l.slice(n,l.length):l.slice(n,l.length-n);e=e.replace(l,"<".concat(t,">").concat(u," </").concat(t,">"))}}catch(h){s=!0,o=h}finally{try{r||null==c.return||c.return()}finally{if(s)throw o}}}return e},a.formattedMessage=function(e){var t=(e=e.replace(/\r?\n/g,"<br>")).match(/(<br>+>>>|^>>>).+\w\S/g),n=(e=(e=a.formatting(e,"blockquote",t,3)).replace(/<br>/g,"%")).match(/(%>+|^>+)[^%]+(?!=%)/g);if(n){var r=!0,s=!1,o=void 0;try{for(var i,c=n[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var l=i.value;l=l.replace(/^(?:%)+/g,""),e=e.replace(l,"<blockquote>".concat(l.slice(1,l.length)," </blockquote>"))}}catch(y){s=!0,o=y}finally{try{r||null==c.return||c.return()}finally{if(s)throw o}}}var u=e.match(/(?<=\s|^|%|_|~|`|>)(\*[^%\*.]+\*)(?=\s|%|_|~|`|<|$)/g),h=(e=a.formatting(e,"b",u,1)).match(/(?<=\s|^|%|\*|~|`|>)(_[^%_.]+_)(?=\s|%|\*|~|`|<|$)/g),d=(e=a.formatting(e,"i",h,1)).match(/(?<=\s|^|%|_|\*|`|>)(~[^%~.]+~)(?=\s|%|\*|_|`|<|$)/g),m=(e=a.formatting(e,"strike",d,1)).match(/```.+?```/g);if(m){var p,f=!0,g=!1,v=void 0;try{for(var E,b=m[Symbol.iterator]();!(f=(E=b.next()).done);f=!0){var C=E.value;p=e.replace(C,"")}}catch(y){g=!0,v=y}finally{try{f||null==b.return||b.return()}finally{if(g)throw v}}e=a.formatting(e,"pre",m,3);var S=p.match(/(?<=\s|^|%)(`[^%`.]+`)/g);e=a.formatting(e,"code",S,1)}else{var I=e.match(/(?<=\s|^|%)(`[^%`.]+`)/g);e=a.formatting(e,"code",I,1)}return e=e.replace(/%/g,"<br>"),a.setState({message:e}),e},a.createMessage=function(e,t){var n=a.state.file,r={timestamp:z.database.ServerValue.TIMESTAMP,userID:e.userID};return""!==n?r.image=n:r.content=t,r},a.sendMessage=function(){var e=a.props,t=e.messageRef,n=e.channel,r=e.user,s=a.state,o=s.message,i=s.error;o.trim()?(a.setState({loading:!0}),t.child(n.id).push().set(a.createMessage(r,a.formattedMessage(o))).then(function(){a.setState({loading:!1,message:"",error:[]}),ve(n,r),be(n.id)}).catch(function(){a.setState({loading:!1,error:i.concat("message can't be send. Try Again !!")})})):a.setState({loading:!1,error:i.concat("write the message")})},a.sendFileMessage=function(e){var t=a.props,n=t.messageRef,r=t.user,s=a.state.error;n.child(e.id).push().set(a.createMessage(r)).then(function(){a.setState({file:"",uploadStatus:"done",error:[]})}).catch(function(){a.setState({loading:!1,uploadStatus:"fail",error:s.concat(" Error in Uploading file in Database. Try Again!! ")})})},a.getSelectionPosition=function(e){a.setState({selectedText:window.getSelection().toString(),selectedPosition:{start:e.target.selectionStart,end:e.target.selectionEnd}})},a.openModal=function(){a.setState({modal:!0})},a.closeModal=function(){a.setState({modal:!1})},a.uploadFile=function(e){var t=a.props.channel,n={contentType:e.type},r=a.state.storageRef;a.setState({uploadTask:r.child("".concat(t.channelName,"/images/").concat(Re()(),".jpg")).put(e,n),uploadStatus:"uploading"},function(){a.state.uploadTask.on("state_changed",function(e){var t=Math.round(e.bytesTransferred/e.totalBytes*100);a.setState({uploadPercentage:t})},function(e){a.setState({error:a.state.error.concat(e.message),uploadTask:"",uploadStatus:"fail"})},function(){a.state.uploadTask.snapshot.ref.getDownloadURL().then(function(e){a.setState({file:e,uploadTask:""}),a.sendFileMessage(t)}).catch(function(e){a.setState({error:a.state.error.push(e),uploadTask:"",uploadStatus:"fail"})})})})},a.addEmoji=function(e){var t=a.state,n=t.message,r=t.cursorPos,s=n.slice(0,r),o=n.slice(r);a.setState({message:"".concat(s).concat(e).concat(o)})},a.handleCommand=function(e){"j"===e.key.toLowerCase()&&e.preventDefault(),e.ctrlKey&&"Enter"===e.key?a.sendMessage():e.ctrlKey&&"b"===e.key.toLowerCase()?a.formatTextAreaMessage("*"):e.ctrlKey&&"i"===e.key.toLowerCase()?a.formatTextAreaMessage("_"):e.ctrlKey&&"j"===e.key.toLowerCase()&&a.formatTextAreaMessage("```")},a.formatTextAreaMessage=function(e){var t=a.state,n=t.message,r=t.selectedPosition,s=t.selectedText,o=n.substring(0,r.start),i=n.substring(r.end,n.length);a.setState({message:"".concat(o," ").concat(e).concat(s).concat(e," ").concat(i)})},a.state={storageRef:z.storage().ref(),message:"",file:"",loading:!1,error:[],modal:!1,uploadTask:null,uploadStatus:"",uploadPercentage:0,cursorPos:0,selectedText:"",selectedPosition:{start:null,end:null}},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){this.getStoragedData()}},{key:"componentDidUpdate",value:function(e){e.channel.channelName!==this.props.channel.channelName&&this.getStoragedData()}},{key:"getStoragedData",value:function(){Ce(this.props.channel.id)?this.setState({message:Ce(this.props.channel.id)}):this.setState({message:""})}},{key:"render",value:function(){var e=this,t=this.state,a=t.message,r=t.loading,s=t.modal,o=t.uploadStatus,i=t.uploadPercentage,c=this.props,l=c.user,u=c.typingUsers,h=c.sideBarVisible,d=l.color.theme[1],m=l.color.theme[2];return n.createElement(B.a,{className:u.length?"messageForm typingSpace":"messageForm",fluid:(!0).toString()},u.length?n.createElement(He,{typingUsers:u}):null,"uploading"===o?n.createElement(xe.a,{style:{position:"fixed",top:"12%",left:"66px",right:h?"260px":"14px"},percent:i,inverted:!0,progress:!0,color:"green"}):"",n.createElement(W.a,null,n.createElement("div",{className:"editor"},n.createElement(Ue.a,{ref:function(t){return e.input=t},placeholder:"Write your message...",onClick:this.getMessage,onKeyDown:this.handleCommand,name:"message",value:a,onChange:this.getMessage,onSelect:this.getSelectionPosition,style:{maxHeight:"175px",minHeight:"41px"}}))),n.createElement(Y.a.Group,{icon:!0,width:"3",fluid:!0,className:"ctlBtn"},n.createElement(Fe,{onSelect:function(t){e.addEmoji(t)}}),n.createElement(Y.a,{style:{backgroundColor:d,color:l.color.text},color:"orange",content:"Add Reply",disabled:r,icon:"edit",labelPosition:"left",onClick:this.sendMessage}),n.createElement(Y.a,{style:{backgroundColor:m,color:l.color.text},color:"teal",content:"Add File",disabled:"uploading"===o,icon:"upload",labelPosition:"left",onClick:this.openModal})),n.createElement(Le,{modal:s,closeModal:this.closeModal,uploadFile:this.uploadFile}))}}]),t}(n.Component),Be=function(e){var t=e.msg,a=e.user,n=e.allUsers.find(function(e){return t.userID===e.userID}),s=Ce("time")===Ae()(t.timestamp).format("Do-MM-YY");Ee("time",Ae()(t.timestamp).format("Do-MM-YY"));var o=Ae()(t.timestamp).format("Do-MM-YY")===Ae()(new Date).format("Do-MM-YY");return r.a.createElement(r.a.Fragment,null,s?null:r.a.createElement("div",{className:"dateGroup"},r.a.createElement("hr",{className:"dateLine"}),r.a.createElement("span",{className:"date"},o?"".concat(Ae()(t.timestamp).format("MMMM Do YYYY"),", Today"):Ae()(t.timestamp).format("MMMM Do YYYY"))),r.a.createElement(je.a,{className:"message-box"},r.a.createElement(je.a.Avatar,{src:n.picture}),r.a.createElement(je.a.Content,{className:a.userID===n.userID?"userMessage":""},r.a.createElement(je.a.Author,{as:"a"},n.username),r.a.createElement(je.a.Metadata,null,Ae()(t.timestamp).format("h:mm a")),t.hasOwnProperty("content")?r.a.createElement(je.a.Text,{dangerouslySetInnerHTML:{__html:t.content}}):r.a.createElement("a",{href:t.image,target:"_blank",downloadable:!0},r.a.createElement(oe.a,{src:t.image,size:"medium",rounded:!0})))))},Ye=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).scrollToBottom=function(){a.scrollRef&&a.scrollRef.scrollIntoView({behavior:"smooth"})},a.fetchMessage=function(){var e=a.state.messageRef,t=a.props,n=t.channel,r=t.channelIDs,s=[];e.once("value",function(t){t.hasChild(n.id)?e.child(n.id).on("child_added",function(e){s.push(Object(h.a)({},e.val())),r.includes(n.id)?a.userCount(s):a.props.setUsersInChannel([])}):(a.props.setMessages([]),r.includes(n.id)?a.userCount(s):a.props.setUsersInChannel([])),a.setState({reachedDBEnd:!0}),a.props.setMessages(s)})},a.userCount=function(e){var t=Object(ye.a)(a.props.otherUsers).concat([a.props.user]);if(e.length){var n=e.reduce(function(e,a){var n=t.find(function(e){return e.userID===a.userID});return e.findIndex(function(e){return e.name===n.username})<0?e.concat({name:n.username,image:n.picture}):e},[]);a.props.setUsersInChannel(n)}else a.props.setUsersInChannel([])},a.findTypingUsers=function(){var e=a.state.typingRef,t=a.props,n=t.channel,r=t.user;e.child(n.id).on("value",function(e){var t=[];for(var n in e.val())r.userID!==n&&t.push(e.val()[n]);a.setState({typingUsers:t})})},a.displayMessages=function(e,t,a){return e.length>0&&e.map(function(e){return n.createElement(Be,{msg:e,key:e.timestamp,user:t,allUsers:Object(ye.a)(a).concat([t])})})},a.searchMessage=function(e){var t=a.props,n=t.messages,r=t.user,s=t.otherUsers,o=[r].concat(Object(ye.a)(s)),i=new RegExp(e,"gi"),c=o.find(function(e){return Boolean(e.username.match(i))});console.log(c),a.setState({searchLoading:!0});var l=n.reduce(function(e,t){return(t.hasOwnProperty("content")&&t.content.match(i)||c&&t.userID===c.userID)&&e.push(t),e},[]);a.setState({searchMsg:l,hasSearchData:!!e}),setTimeout(function(){a.setState({searchLoading:!1})},1e3)},a.metaData=function(){var e=a.props,t=e.channelIDs,n=e.channel,r=e.user,s=e.otherUsers,o=e.usersInChannel;if(t.includes(n.id))return o;var i=r.userID,c=new RegExp(i,"gi"),l=n.id.replace(c,""),u=s.findIndex(function(e){return e.userID===l});return Object(h.a)({},s[u])},a.clearSearchData=function(){a.setState({hasSearchData:!1,searchMsg:[]})},a.state={messageRef:z.database().ref("messages"),userRef:z.database().ref("users"),typingRef:z.database().ref("typing"),typingUsers:[],channelUsers:[],reachedDBEnd:!1,searchMsg:[],searchLoading:!1,userInHeader:{},hasSearchData:!1,connectionRef:z.database().ref(".info/connected")},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.scrollToBottom(),this.fetchMessage(),this.findTypingUsers(),this.state.connectionRef.on("value",function(t){!0===t.val()&&e.state.typingRef.child(e.props.channel.id).child(e.props.user.userID).onDisconnect().remove(function(e){null!==e&&console.error(e)})})}},{key:"componentDidUpdate",value:function(e){this.scrollToBottom(),e.channel.channelName!==this.props.channel.channelName&&(this.setState({reachedDBEnd:!1}),clearTimeout(this.time),this.fetchMessage(),this.findTypingUsers())}},{key:"componentWillUnmount",value:function(){var e=this.state,t=e.typingRef,a=e.connectionRef,n=e.messageRef,r=this.props.channel;t.child(r.id).off(),a.off(),n.child(r.id).off()}},{key:"render",value:function(){var e=this,t=this.state,a=t.messageRef,r=t.searchMsg,s=t.searchLoading,o=t.typingUsers,i=t.inputValue,c=t.reachedDBEnd,l=t.hasSearchData,u=this.props,h=u.channel,d=u.user,m=u.privateChannel,p=u.activeChannelID,f=u.setShowChannelInfo,g=u.otherUsers,v=u.messages,E=u.sideBar;return n.createElement(n.Fragment,null,n.createElement(Me,{channelName:h.channelName,metaData:this.metaData(),searchMessage:function(t){e.searchMessage(t)},user:d,activeChannelID:p,searchLoading:s,hasSearchData:l,privateChannel:m,showChannelInfo:function(){f(!0)},clearSearchData:this.clearSearchData}),n.createElement(B.a,{className:"messages"},v.length||c?n.createElement(n.Fragment,null,n.createElement(je.a.Group,{size:"large"},l?this.displayMessages(r,d,g):this.displayMessages(v,d,g)),n.createElement("div",{ref:function(t){e.scrollRef=t}})):n.createElement(le.a,{active:!0},"Loading Messages....")),n.createElement(We,{messageRef:a,inputValue:i,channel:h,user:d,typingUsers:o,sideBarVisible:E}))}}]),t}(n.Component),Ve=Object(c.b)(function(e){var t=e.user,a=e.channel,n=e.messages;return{user:t.currentUser,otherUsers:t.otherUsers,channel:a.currentChannel,activeChannelID:a.activeChannelID,channelIDs:a.channelIDs,privateChannel:a.privateChannel,usersInChannel:a.usersInChannel,messages:n.messages}},function(e){return{setUsersInChannel:function(t){return e(function(e){return{type:d.SET_USERS_IN_CHANNEL,payload:e}}(t))},setShowChannelInfo:function(t){return e(g(t))},setMessages:function(t){return e(function(e){return{type:d.SET_MESSAGES,payload:e}}(t))}}})(Ye),ze=a(597),Ge=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).handleClick=function(e,t){var n=t.index,r=a.state.activeIndex===n?-1:n;a.setState({activeIndex:r})},a.creator=function(){var e=a.props,t=e.otherUsers,n=e.user,s=e.channel,o=t.find(function(e){return e.userID===s.createdBy}),i=o?{name:o.username,image:o.picture}:{name:"You",image:n.picture};return r.a.createElement(P.a,{as:"h3"},r.a.createElement(oe.a,{circular:!0,src:i.image})," ",i.name)},a.channelUsers=function(){return a.props.usersInChannel.map(function(e,t){return r.a.createElement(P.a,{as:"h5",key:t,style:{margin:"6px 0px"}},r.a.createElement(oe.a,{circular:!0,src:e.image})," ",e.name)})},a.state={activeIndex:0},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.state.activeIndex,t=this.props,a=t.channel,n=t.showChannelInfo;return r.a.createElement(ze.a,{styled:!0},r.a.createElement(F.a,{name:"close",className:"metapannel-close",onClick:n}),r.a.createElement(ze.a.Title,{active:0===e,index:0,onClick:this.handleClick},r.a.createElement(F.a,{name:"dropdown"}),"About Channel ",r.a.createElement(F.a,{name:"info circle"})),r.a.createElement(ze.a.Content,{active:0===e},r.a.createElement("p",null,a.channelDetail,r.a.createElement("br",null),"Created On : ",Ae()(a.createdOn).format(" Do MMMM YYYY "))),r.a.createElement(ze.a.Title,{active:1===e,index:1,onClick:this.handleClick},r.a.createElement(F.a,{name:"dropdown"}),"Contributors ",r.a.createElement(F.a,{name:"users"})),r.a.createElement(ze.a.Content,{active:1===e},this.channelUsers()),r.a.createElement(ze.a.Title,{active:2===e,index:2,onClick:this.handleClick},r.a.createElement(F.a,{name:"dropdown"}),"Creator ",r.a.createElement(F.a,{name:"write"})),r.a.createElement(ze.a.Content,{active:2===e},this.creator()))}}]),t}(n.Component),qe=(a(568),function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).checkWidth=function(){window.addEventListener("resize",function(){a.setState({visible:window.innerWidth>678})})},a.removeToken=function(){z.database().ref("tokens").orderByChild("uid").equalTo(z.auth().currentUser.uid).once("value").then(function(e){if(e.val()){var t=Object.keys(e.val());t.length>1&&z.database().ref("tokens").child(t[0]).remove()}})},a.showSidebar=function(){a.setState(function(e){return{isShow:!e.isShow}})},a.state={isShow:!1,visible:window.innerWidth>678},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){this.checkWidth(),this.removeToken(),z.messaging().onTokenRefresh(z.messaging().requestPermission().then(function(){return z.messaging().getToken().then(function(e){z.database().ref("tokens").push({token:e,uid:z.auth().currentUser.uid})})}).catch(function(e){console.log("Error Getting Permission")}))}},{key:"render",value:function(){var e=this,t=this.props,a=t.user,n=t.channel,s=t.privateChannel,o=t.otherUsers,i=t.usersInChannel,c=t.showChannelInfo,l=this.state,u=l.visible,h=l.isShow,d=u||h;return r.a.createElement(H.a,{columns:"equal",style:{background:"#fff",marginTop:"0px",height:"100vh",margin:0}},r.a.createElement(H.a.Column,{className:"my-container"},n.id&&r.a.createElement(Ve,{sideBar:u})),a.userID&&r.a.createElement(we,{visibleSideBar:d,user:a,showSidebar:this.showSidebar}),r.a.createElement(ae,{user:a,showSidebar:this.showSidebar}),!s&&c&&o.length&&r.a.createElement("div",{className:"metapannel-box"},r.a.createElement(Ge,{channel:n,otherUsers:o,user:a,usersInChannel:i,showChannelInfo:function(){e.props.setShowChannelInfo(!1)}})))}}]),t}(r.a.Component)),Ke=Object(c.b)(function(e){var t=e.user,a=e.channel;return{user:t.currentUser,otherUsers:t.otherUsers,channel:a.currentChannel,privateChannel:a.privateChannel,usersInChannel:a.usersInChannel,showChannelInfo:a.showChannelInfo}},function(e){return{setShowChannelInfo:function(t){return e(g(t))}}})(qe),$e=(a(570),function(e){var t=e.component,a=Object(j.a)(e,["component"]);return r.a.createElement(T.a,Object.assign({},a,{render:function(e){return a.isAuthenticated?r.a.createElement(t,e):r.a.createElement(A.a,{to:"/login"})}}))}),Je=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(k.a)(this,Object(N.a)(t).call(this,e))).setStatus=function(e){var t=a.state,n=t.connectionRef,r=t.persence;n.on("value",function(t){if(t.val()){var a=r.child(e.userID);a.set(!0),a.onDisconnect().remove(),U.a.database().ref("users/".concat(e.userID)).onDisconnect().set(Object(h.a)({},e,{lastSeen:U.a.database.ServerValue.TIMESTAMP,status:"offline"}))}}),r.on("child_added",function(t){e.userID===t.key&&a.addStatus(e)})},a.addStatus=function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];U.a.database().ref("users/".concat(e.userID)).set(Object(h.a)({},e,{status:"online",lastSeen:""}))},a.state={connectionRef:U.a.database().ref(".info/connected"),persence:U.a.database().ref("presence")},a}return Object(w.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log("checkAUth"),U.a.auth().onAuthStateChanged(function(t){t?U.a.database().ref("users/".concat(t.uid)).on("value",function(t){t.val()?(e.setStatus(t.val()),e.props.setuser(t.val()),e.props.history.push("/")):e.props.history.push("/login")}):(e.props.clearuser(),e.props.history.push("/login"))})}},{key:"render",value:function(){return this.props.loading?r.a.createElement(ue,null):r.a.createElement(M.a,null,r.a.createElement(T.a,{path:"/login",component:G}),r.a.createElement($e,{exact:!0,path:"/",component:Ke,isAuthenticated:this.props.isAuthenticated}),r.a.createElement(T.a,{path:"/register",component:J}))}}]),t}(n.Component),Qe=Object(_.a)(Object(c.b)(function(e){var t=e.user;return{loading:t.loading,isAuthenticated:t.isAuthenticated}},function(e){return{setuser:function(t){return e((a=t,{type:d.SET_USER,payload:a}));var a},clearuser:function(){return e({type:d.CLEAR_USER})}}})(Je));a(572),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(574);var Ze=Object(i.createStore)(y,Object(l.composeWithDevTools)()),Xe=r.a.createElement(c.a,{store:Ze},r.a.createElement(u.a,{basename:"/dev-desk-chatting-app"},r.a.createElement(Qe,null)));o.a.render(Xe,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[297,2,1]]]);
//# sourceMappingURL=main.41eaef3a.chunk.js.map